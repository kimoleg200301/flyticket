{"ast":null,"code":"import { __awaiter, __generator } from \"tslib\";\nimport { PNG } from \"../../utils/png\";\n/**\r\n * A note of thanks to the developers of https://github.com/foliojs/pdfkit, as\r\n * this class borrows from:\r\n *   https://github.com/devongovett/pdfkit/blob/e71edab0dd4657b5a767804ba86c94c58d01fbca/lib/image/png.coffee\r\n */\nvar PngEmbedder = /** @class */function () {\n  function PngEmbedder(png) {\n    this.image = png;\n    this.bitsPerComponent = png.bitsPerComponent;\n    this.width = png.width;\n    this.height = png.height;\n    this.colorSpace = 'DeviceRGB';\n  }\n  PngEmbedder.for = function (imageData) {\n    return __awaiter(this, void 0, void 0, function () {\n      var png;\n      return __generator(this, function (_a) {\n        png = PNG.load(imageData);\n        return [2 /*return*/, new PngEmbedder(png)];\n      });\n    });\n  };\n  PngEmbedder.prototype.embedIntoContext = function (context, ref) {\n    return __awaiter(this, void 0, void 0, function () {\n      var SMask, xObject;\n      return __generator(this, function (_a) {\n        SMask = this.embedAlphaChannel(context);\n        xObject = context.flateStream(this.image.rgbChannel, {\n          Type: 'XObject',\n          Subtype: 'Image',\n          BitsPerComponent: this.image.bitsPerComponent,\n          Width: this.image.width,\n          Height: this.image.height,\n          ColorSpace: this.colorSpace,\n          SMask: SMask\n        });\n        if (ref) {\n          context.assign(ref, xObject);\n          return [2 /*return*/, ref];\n        } else {\n          return [2 /*return*/, context.register(xObject)];\n        }\n        return [2 /*return*/];\n      });\n    });\n  };\n  PngEmbedder.prototype.embedAlphaChannel = function (context) {\n    if (!this.image.alphaChannel) return undefined;\n    var xObject = context.flateStream(this.image.alphaChannel, {\n      Type: 'XObject',\n      Subtype: 'Image',\n      Height: this.image.height,\n      Width: this.image.width,\n      BitsPerComponent: this.image.bitsPerComponent,\n      ColorSpace: 'DeviceGray',\n      Decode: [0, 1]\n    });\n    return context.register(xObject);\n  };\n  return PngEmbedder;\n}();\nexport default PngEmbedder;","map":{"version":3,"names":["PNG","PngEmbedder","png","image","bitsPerComponent","width","height","colorSpace","for","imageData","load","prototype","embedIntoContext","context","ref","SMask","embedAlphaChannel","xObject","flateStream","rgbChannel","Type","Subtype","BitsPerComponent","Width","Height","ColorSpace","assign","register","alphaChannel","undefined","Decode"],"sources":["C:\\oleg\\flyticket\\frontend\\flyticket\\node_modules\\pdf-lib\\src\\core\\embedders\\PngEmbedder.ts"],"sourcesContent":["import PDFRef from 'src/core/objects/PDFRef';\r\nimport PDFContext from 'src/core/PDFContext';\r\nimport { PNG } from 'src/utils/png';\r\n\r\n/**\r\n * A note of thanks to the developers of https://github.com/foliojs/pdfkit, as\r\n * this class borrows from:\r\n *   https://github.com/devongovett/pdfkit/blob/e71edab0dd4657b5a767804ba86c94c58d01fbca/lib/image/png.coffee\r\n */\r\nclass PngEmbedder {\r\n  static async for(imageData: Uint8Array) {\r\n    const png = PNG.load(imageData);\r\n    return new PngEmbedder(png);\r\n  }\r\n\r\n  readonly bitsPerComponent: number;\r\n  readonly height: number;\r\n  readonly width: number;\r\n  readonly colorSpace: 'DeviceRGB';\r\n\r\n  private readonly image: PNG;\r\n\r\n  private constructor(png: PNG) {\r\n    this.image = png;\r\n    this.bitsPerComponent = png.bitsPerComponent;\r\n    this.width = png.width;\r\n    this.height = png.height;\r\n    this.colorSpace = 'DeviceRGB';\r\n  }\r\n\r\n  async embedIntoContext(context: PDFContext, ref?: PDFRef): Promise<PDFRef> {\r\n    const SMask = this.embedAlphaChannel(context);\r\n\r\n    const xObject = context.flateStream(this.image.rgbChannel, {\r\n      Type: 'XObject',\r\n      Subtype: 'Image',\r\n      BitsPerComponent: this.image.bitsPerComponent,\r\n      Width: this.image.width,\r\n      Height: this.image.height,\r\n      ColorSpace: this.colorSpace,\r\n      SMask,\r\n    });\r\n\r\n    if (ref) {\r\n      context.assign(ref, xObject);\r\n      return ref;\r\n    } else {\r\n      return context.register(xObject);\r\n    }\r\n  }\r\n\r\n  private embedAlphaChannel(context: PDFContext): PDFRef | undefined {\r\n    if (!this.image.alphaChannel) return undefined;\r\n\r\n    const xObject = context.flateStream(this.image.alphaChannel, {\r\n      Type: 'XObject',\r\n      Subtype: 'Image',\r\n      Height: this.image.height,\r\n      Width: this.image.width,\r\n      BitsPerComponent: this.image.bitsPerComponent,\r\n      ColorSpace: 'DeviceGray',\r\n      Decode: [0, 1],\r\n    });\r\n\r\n    return context.register(xObject);\r\n  }\r\n}\r\n\r\nexport default PngEmbedder;\r\n"],"mappings":";AAEA,SAASA,GAAG,QAAE;AAEd;;;;;AAKA,IAAAC,WAAA;EAaE,SAAAA,YAAoBC,GAAQ;IAC1B,IAAI,CAACC,KAAK,GAAGD,GAAG;IAChB,IAAI,CAACE,gBAAgB,GAAGF,GAAG,CAACE,gBAAgB;IAC5C,IAAI,CAACC,KAAK,GAAGH,GAAG,CAACG,KAAK;IACtB,IAAI,CAACC,MAAM,GAAGJ,GAAG,CAACI,MAAM;IACxB,IAAI,CAACC,UAAU,GAAG,WAAW;EAC/B;EAlBaN,WAAA,CAAAO,GAAG,GAAhB,UAAiBC,SAAqB;;;;QAC9BP,GAAG,GAAGF,GAAG,CAACU,IAAI,CAACD,SAAS,CAAC;QAC/B,sBAAO,IAAIR,WAAW,CAACC,GAAG,CAAC;;;GAC5B;EAiBKD,WAAA,CAAAU,SAAA,CAAAC,gBAAgB,GAAtB,UAAuBC,OAAmB,EAAEC,GAAY;;;;QAChDC,KAAK,GAAG,IAAI,CAACC,iBAAiB,CAACH,OAAO,CAAC;QAEvCI,OAAO,GAAGJ,OAAO,CAACK,WAAW,CAAC,IAAI,CAACf,KAAK,CAACgB,UAAU,EAAE;UACzDC,IAAI,EAAE,SAAS;UACfC,OAAO,EAAE,OAAO;UAChBC,gBAAgB,EAAE,IAAI,CAACnB,KAAK,CAACC,gBAAgB;UAC7CmB,KAAK,EAAE,IAAI,CAACpB,KAAK,CAACE,KAAK;UACvBmB,MAAM,EAAE,IAAI,CAACrB,KAAK,CAACG,MAAM;UACzBmB,UAAU,EAAE,IAAI,CAAClB,UAAU;UAC3BQ,KAAK,EAAAA;SACN,CAAC;QAEF,IAAID,GAAG,EAAE;UACPD,OAAO,CAACa,MAAM,CAACZ,GAAG,EAAEG,OAAO,CAAC;UAC5B,sBAAOH,GAAG;SACX,MAAM;UACL,sBAAOD,OAAO,CAACc,QAAQ,CAACV,OAAO,CAAC;;;;;GAEnC;EAEOhB,WAAA,CAAAU,SAAA,CAAAK,iBAAiB,GAAzB,UAA0BH,OAAmB;IAC3C,IAAI,CAAC,IAAI,CAACV,KAAK,CAACyB,YAAY,EAAE,OAAOC,SAAS;IAE9C,IAAMZ,OAAO,GAAGJ,OAAO,CAACK,WAAW,CAAC,IAAI,CAACf,KAAK,CAACyB,YAAY,EAAE;MAC3DR,IAAI,EAAE,SAAS;MACfC,OAAO,EAAE,OAAO;MAChBG,MAAM,EAAE,IAAI,CAACrB,KAAK,CAACG,MAAM;MACzBiB,KAAK,EAAE,IAAI,CAACpB,KAAK,CAACE,KAAK;MACvBiB,gBAAgB,EAAE,IAAI,CAACnB,KAAK,CAACC,gBAAgB;MAC7CqB,UAAU,EAAE,YAAY;MACxBK,MAAM,EAAE,CAAC,CAAC,EAAE,CAAC;KACd,CAAC;IAEF,OAAOjB,OAAO,CAACc,QAAQ,CAACV,OAAO,CAAC;EAClC,CAAC;EACH,OAAAhB,WAAC;AAAD,CAAC,CAzDD;AA2DA,eAAeA,WAAW","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}