{"ast":null,"code":"/*\r\n * Copyright 2012 Mozilla Foundation\r\n *\r\n * The LZWStream class contained in this file is a TypeScript port of the\r\n * JavaScript LZWStream class in Mozilla's pdf.js project, made available\r\n * under the Apache 2.0 open source license.\r\n */\nimport { __extends } from \"tslib\";\nimport DecodeStream from \"./DecodeStream\";\nvar LZWStream = /** @class */function (_super) {\n  __extends(LZWStream, _super);\n  function LZWStream(stream, maybeLength, earlyChange) {\n    var _this = _super.call(this, maybeLength) || this;\n    _this.stream = stream;\n    _this.cachedData = 0;\n    _this.bitsCached = 0;\n    var maxLzwDictionarySize = 4096;\n    var lzwState = {\n      earlyChange: earlyChange,\n      codeLength: 9,\n      nextCode: 258,\n      dictionaryValues: new Uint8Array(maxLzwDictionarySize),\n      dictionaryLengths: new Uint16Array(maxLzwDictionarySize),\n      dictionaryPrevCodes: new Uint16Array(maxLzwDictionarySize),\n      currentSequence: new Uint8Array(maxLzwDictionarySize),\n      currentSequenceLength: 0\n    };\n    for (var i = 0; i < 256; ++i) {\n      lzwState.dictionaryValues[i] = i;\n      lzwState.dictionaryLengths[i] = 1;\n    }\n    _this.lzwState = lzwState;\n    return _this;\n  }\n  LZWStream.prototype.readBlock = function () {\n    var blockSize = 512;\n    var estimatedDecodedSize = blockSize * 2;\n    var decodedSizeDelta = blockSize;\n    var i;\n    var j;\n    var q;\n    var lzwState = this.lzwState;\n    if (!lzwState) {\n      return; // eof was found\n    }\n    var earlyChange = lzwState.earlyChange;\n    var nextCode = lzwState.nextCode;\n    var dictionaryValues = lzwState.dictionaryValues;\n    var dictionaryLengths = lzwState.dictionaryLengths;\n    var dictionaryPrevCodes = lzwState.dictionaryPrevCodes;\n    var codeLength = lzwState.codeLength;\n    var prevCode = lzwState.prevCode;\n    var currentSequence = lzwState.currentSequence;\n    var currentSequenceLength = lzwState.currentSequenceLength;\n    var decodedLength = 0;\n    var currentBufferLength = this.bufferLength;\n    var buffer = this.ensureBuffer(this.bufferLength + estimatedDecodedSize);\n    for (i = 0; i < blockSize; i++) {\n      var code = this.readBits(codeLength);\n      var hasPrev = currentSequenceLength > 0;\n      if (!code || code < 256) {\n        currentSequence[0] = code;\n        currentSequenceLength = 1;\n      } else if (code >= 258) {\n        if (code < nextCode) {\n          currentSequenceLength = dictionaryLengths[code];\n          for (j = currentSequenceLength - 1, q = code; j >= 0; j--) {\n            currentSequence[j] = dictionaryValues[q];\n            q = dictionaryPrevCodes[q];\n          }\n        } else {\n          currentSequence[currentSequenceLength++] = currentSequence[0];\n        }\n      } else if (code === 256) {\n        codeLength = 9;\n        nextCode = 258;\n        currentSequenceLength = 0;\n        continue;\n      } else {\n        this.eof = true;\n        delete this.lzwState;\n        break;\n      }\n      if (hasPrev) {\n        dictionaryPrevCodes[nextCode] = prevCode;\n        dictionaryLengths[nextCode] = dictionaryLengths[prevCode] + 1;\n        dictionaryValues[nextCode] = currentSequence[0];\n        nextCode++;\n        codeLength = nextCode + earlyChange & nextCode + earlyChange - 1 ? codeLength : Math.min(Math.log(nextCode + earlyChange) / 0.6931471805599453 + 1, 12) | 0;\n      }\n      prevCode = code;\n      decodedLength += currentSequenceLength;\n      if (estimatedDecodedSize < decodedLength) {\n        do {\n          estimatedDecodedSize += decodedSizeDelta;\n        } while (estimatedDecodedSize < decodedLength);\n        buffer = this.ensureBuffer(this.bufferLength + estimatedDecodedSize);\n      }\n      for (j = 0; j < currentSequenceLength; j++) {\n        buffer[currentBufferLength++] = currentSequence[j];\n      }\n    }\n    lzwState.nextCode = nextCode;\n    lzwState.codeLength = codeLength;\n    lzwState.prevCode = prevCode;\n    lzwState.currentSequenceLength = currentSequenceLength;\n    this.bufferLength = currentBufferLength;\n  };\n  LZWStream.prototype.readBits = function (n) {\n    var bitsCached = this.bitsCached;\n    var cachedData = this.cachedData;\n    while (bitsCached < n) {\n      var c = this.stream.getByte();\n      if (c === -1) {\n        this.eof = true;\n        return null;\n      }\n      cachedData = cachedData << 8 | c;\n      bitsCached += 8;\n    }\n    this.bitsCached = bitsCached -= n;\n    this.cachedData = cachedData;\n    return cachedData >>> bitsCached & (1 << n) - 1;\n  };\n  return LZWStream;\n}(DecodeStream);\nexport default LZWStream;","map":{"version":3,"names":["DecodeStream","LZWStream","_super","__extends","stream","maybeLength","earlyChange","_this","call","cachedData","bitsCached","maxLzwDictionarySize","lzwState","codeLength","nextCode","dictionaryValues","Uint8Array","dictionaryLengths","Uint16Array","dictionaryPrevCodes","currentSequence","currentSequenceLength","i","prototype","readBlock","blockSize","estimatedDecodedSize","decodedSizeDelta","j","q","prevCode","decodedLength","currentBufferLength","bufferLength","buffer","ensureBuffer","code","readBits","hasPrev","eof","Math","min","log","n","c","getByte"],"sources":["C:\\oleg\\flyticket\\frontend\\flyticket\\node_modules\\pdf-lib\\src\\core\\streams\\LZWStream.ts"],"sourcesContent":["/*\r\n * Copyright 2012 Mozilla Foundation\r\n *\r\n * The LZWStream class contained in this file is a TypeScript port of the\r\n * JavaScript LZWStream class in Mozilla's pdf.js project, made available\r\n * under the Apache 2.0 open source license.\r\n */\r\n\r\nimport DecodeStream from 'src/core/streams/DecodeStream';\r\nimport { StreamType } from 'src/core/streams/Stream';\r\n\r\nclass LZWStream extends DecodeStream {\r\n  private stream: StreamType;\r\n  private cachedData: number;\r\n  private bitsCached: number;\r\n  private lzwState: {\r\n    earlyChange: 0 | 1;\r\n    codeLength: number;\r\n    nextCode: number;\r\n    dictionaryValues: Uint8Array;\r\n    dictionaryLengths: Uint16Array;\r\n    dictionaryPrevCodes: Uint16Array;\r\n    currentSequence: Uint8Array;\r\n    currentSequenceLength: number;\r\n    prevCode?: number | null;\r\n  };\r\n\r\n  constructor(\r\n    stream: StreamType,\r\n    maybeLength: number | undefined,\r\n    earlyChange: 0 | 1,\r\n  ) {\r\n    super(maybeLength);\r\n\r\n    this.stream = stream;\r\n    this.cachedData = 0;\r\n    this.bitsCached = 0;\r\n\r\n    const maxLzwDictionarySize = 4096;\r\n    const lzwState = {\r\n      earlyChange,\r\n      codeLength: 9,\r\n      nextCode: 258,\r\n      dictionaryValues: new Uint8Array(maxLzwDictionarySize),\r\n      dictionaryLengths: new Uint16Array(maxLzwDictionarySize),\r\n      dictionaryPrevCodes: new Uint16Array(maxLzwDictionarySize),\r\n      currentSequence: new Uint8Array(maxLzwDictionarySize),\r\n      currentSequenceLength: 0,\r\n    };\r\n    for (let i = 0; i < 256; ++i) {\r\n      lzwState.dictionaryValues[i] = i;\r\n      lzwState.dictionaryLengths[i] = 1;\r\n    }\r\n    this.lzwState = lzwState;\r\n  }\r\n\r\n  protected readBlock() {\r\n    const blockSize = 512;\r\n\r\n    let estimatedDecodedSize = blockSize * 2;\r\n    const decodedSizeDelta = blockSize;\r\n    let i;\r\n    let j;\r\n    let q;\r\n\r\n    const lzwState = this.lzwState;\r\n    if (!lzwState) {\r\n      return; // eof was found\r\n    }\r\n\r\n    const earlyChange = lzwState.earlyChange;\r\n    let nextCode = lzwState.nextCode;\r\n    const dictionaryValues = lzwState.dictionaryValues;\r\n    const dictionaryLengths = lzwState.dictionaryLengths;\r\n    const dictionaryPrevCodes = lzwState.dictionaryPrevCodes;\r\n    let codeLength = lzwState.codeLength;\r\n    let prevCode = lzwState.prevCode;\r\n    const currentSequence = lzwState.currentSequence;\r\n    let currentSequenceLength = lzwState.currentSequenceLength;\r\n\r\n    let decodedLength = 0;\r\n    let currentBufferLength = this.bufferLength;\r\n    let buffer = this.ensureBuffer(this.bufferLength + estimatedDecodedSize);\r\n\r\n    for (i = 0; i < blockSize; i++) {\r\n      const code = this.readBits(codeLength);\r\n      const hasPrev = currentSequenceLength > 0;\r\n      if (!code || code < 256) {\r\n        currentSequence[0] = code as number;\r\n        currentSequenceLength = 1;\r\n      } else if (code >= 258) {\r\n        if (code < nextCode) {\r\n          currentSequenceLength = dictionaryLengths[code];\r\n          for (j = currentSequenceLength - 1, q = code; j >= 0; j--) {\r\n            currentSequence[j] = dictionaryValues[q];\r\n            q = dictionaryPrevCodes[q];\r\n          }\r\n        } else {\r\n          currentSequence[currentSequenceLength++] = currentSequence[0];\r\n        }\r\n      } else if (code === 256) {\r\n        codeLength = 9;\r\n        nextCode = 258;\r\n        currentSequenceLength = 0;\r\n        continue;\r\n      } else {\r\n        this.eof = true;\r\n        delete this.lzwState;\r\n        break;\r\n      }\r\n\r\n      if (hasPrev) {\r\n        dictionaryPrevCodes[nextCode] = prevCode as number;\r\n        dictionaryLengths[nextCode] = dictionaryLengths[prevCode as number] + 1;\r\n        dictionaryValues[nextCode] = currentSequence[0];\r\n        nextCode++;\r\n        codeLength =\r\n          (nextCode + earlyChange) & (nextCode + earlyChange - 1)\r\n            ? codeLength\r\n            : Math.min(\r\n                Math.log(nextCode + earlyChange) / 0.6931471805599453 + 1,\r\n                12,\r\n              ) | 0;\r\n      }\r\n      prevCode = code;\r\n\r\n      decodedLength += currentSequenceLength;\r\n      if (estimatedDecodedSize < decodedLength) {\r\n        do {\r\n          estimatedDecodedSize += decodedSizeDelta;\r\n        } while (estimatedDecodedSize < decodedLength);\r\n        buffer = this.ensureBuffer(this.bufferLength + estimatedDecodedSize);\r\n      }\r\n      for (j = 0; j < currentSequenceLength; j++) {\r\n        buffer[currentBufferLength++] = currentSequence[j];\r\n      }\r\n    }\r\n    lzwState.nextCode = nextCode;\r\n    lzwState.codeLength = codeLength;\r\n    lzwState.prevCode = prevCode;\r\n    lzwState.currentSequenceLength = currentSequenceLength;\r\n\r\n    this.bufferLength = currentBufferLength;\r\n  }\r\n\r\n  private readBits(n: number) {\r\n    let bitsCached = this.bitsCached;\r\n    let cachedData = this.cachedData;\r\n    while (bitsCached < n) {\r\n      const c = this.stream.getByte();\r\n      if (c === -1) {\r\n        this.eof = true;\r\n        return null;\r\n      }\r\n      cachedData = (cachedData << 8) | c;\r\n      bitsCached += 8;\r\n    }\r\n    this.bitsCached = bitsCached -= n;\r\n    this.cachedData = cachedData;\r\n    return (cachedData >>> bitsCached) & ((1 << n) - 1);\r\n  }\r\n}\r\n\r\nexport default LZWStream;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}